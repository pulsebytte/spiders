import gcsfs
import pandas as pd
import os 



os.environ["GOOGLE_APPLICATION_CREDENTIALS"] = "D:\MyBuild\GCP\pulsebyttedatawork-b1df70745eae.json"


fs = gcsfs.GCSFileSystem(project="pulsebyttedatawork")
file_path = f"gs://{"my-valid-bronze-bucket-name"}/{"e-commerce-data.csv"}"

# df = pd.read_csv(file_path, storage_options={'project': 'pulsebyttedatawork'}, chunksize=10000)
# for i in df:
#     print(i)



# def separate_rating(chunk):

#     chunk[['count','rating']] = chunk['']


def data_read_and_process(bucket_name, file_name, chunksize):
    
    # os.environ["GOOGLE_APPLICATION_CREDENTIALS"] = "D:\MyBuild\GCP\pulsebyttedatawork-b1df70745eae.json"
    # fs = gcsfs.GCSFileSystem(project= "pulsebyttedatawork")
    # file_path = f"gs://{"my-valid-bronze-bucket-name"}/{"e-commerce-data.csv"}"

    processed_data = []

    df = pd.read_csv(file_path, storage_options={'project': 'pulsebyttedatawork'}, chunksize=10000)
    for i in df:
        print(i)
    
    df[['rate','count']] = df['rating'].apply(pd.Series)
    print(df)
    



bucket_name = "my-valid-bronze-bucket-name"
file_name =  "e-commerce-data.csv"
chunksize=10000

df = data_read_and_process(bucket_name, file_name, chunksize)
